<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.0/css/bootstrap.min.css">
    <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>

    <style>
        textarea:focus{
            outline: 0;
        }
        .btn:focus,.btn:active:focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn.active.focus {
            outline: none;
            border-color: transparent;
            box-shadow:none;
        }
        .shadow{
            -webkit-box-shadow: 0 1px 5px 0 rgba(0,34,77,.12);
            -moz-box-shadow: 0 1px 5px 0 rgba(0,34,77,.12);
            box-shadow: 0 1px 5px 0 rgba(0,34,77,.12);
        }
        .shadow-smaller{
            -webkit-box-shadow: 0 1px 5px 0 rgba(0,34,77,.07);
            -moz-box-shadow: 0 1px 5px 0 rgba(0,34,77,.07);
            box-shadow: 0 1px 5px 0 rgba(0,34,77,.07);
        }

    </style>
</head>
<body style="background-color: #fafafa">

<div class="container-fluid">
    <div class="col-md-12 column" style="position: fixed;top: 0;z-index: 999">
        <div class="row clearfix">
            <div class="col-md-2 column">
            </div>
            <div class="col-md-8 column" style="">
                <div class="row clearfix">
                    <ul class="nav nav-pills shadow" style="background-color: #ffffff;margin-right: -3px;margin-left: 5px">
                        <li class="active">
                            <a href="http://127.0.0.1:3000/home" style="padding: 0 10px 0 10px;font-size: 28px">知</a>
                        </li>
                        <li>
                            <a href="http://127.0.0.1:3000/home">首页</a>
                        </li>
                        <li class="disabled">
                            <a href="#">发现</a>
                        </li>
                        <li>
                            <a class="text-muted" href="http://127.0.0.1:3000/topicSquare">话题</a>
                        </li>
                        <li style="margin-left: 60px;margin-top: 3px">
                            <div class="input-group" style="width:342px">
                            <input type="text" class="form-control">
                            <span class="input-group-addon" style="background-color: #6db0ff;color:white;">搜索</span>
                        </div>
            </li>
                        <li class="dropdown pull-right" style="margin-top: 7px;margin-right: 8px">
                            <span class="text-muted" style="margin-right: 18px;">消息</span>
                            <img data-toggle="dropdown" src="http://127.0.0.1:3000/static/userhead/3.jpg" style="width:28px">
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="http://127.0.0.1:3000/people/me/myask">个人主页</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="http://127.0.0.1:3000/logout">退出登录</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="col-md-2 column">
            </div>
        </div>
    </div>

    <div class="col-md-12 column" style="margin-top: 50px">
        <div class="row clearfix">
            <div class="col-md-2 column">
            </div>
            <div class="col-md-5 column" style="padding:0;margin: 2px">
                <div class="shadow-smaller" style="background-color: white;margin-left: 10px;margin-right:-10px;padding:15px;border:1px #fafafa;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px; ">
                    <span id="test" style="font-size: 24px;"><strong>梅西有多强?</strong></span>
                    <span style="color:#0084ff;background-color: #e5f2ff;padding: 4px 7px 4px 7px;border:0 solid;border-top-right-radius:8px; border-top-left-radius:8px; border-bottom-left-radius:8px; border-bottom-right-radius:8px;">巴塞罗那</span>
                    <br/>
                    <span>从数据和实战来分析，或者与历史上的巅峰球星对比。</span>
                </div>

                <div class="shadow-smaller" style="margin-top: 0;border: #fafafa solid 1px;background-color: white;margin-left: 10px;;margin-bottom: 10px;margin-right:-10px;padding:15px;">
                    <span style="border: #f3f3f3 solid 1px;background-color: #0084ff;padding:8px 18px 8px 18px;border-top-right-radius:5px; border-top-left-radius:5px; border-bottom-left-radius:5px; border-bottom-right-radius:5px;color:white ;">关注问题</span>
                    <span id="toanswer" style="margin-left: 22px;border: #0084ff solid 1px;background-color: white;padding:8px 18px 8px 18px;border-top-right-radius:5px; border-top-left-radius:5px; border-bottom-left-radius:5px; border-bottom-right-radius:5px;color:#0084ff ;">写回答</span>
                    <span style="margin-left: 22px;color:#77839c">评论</span>
                    <span id="share" style="margin-left: 22px;color: #77839c">分享</span>
                    <span style="margin-left: 22px;color: #77839c">举报</span>
                    <span style="margin-left: 22px;color: #77839c">•••</span>
                </div>
                <div class="alert alert-success" style="display:none">发表成功</div>
                <div id='answering' style="display: none">
                    <div class="shadow-smaller" style="background-color: white;margin-left: 10px;margin-right:-10px;padding:15px;border:1px #fafafa;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px; ">
                        <img src="http://127.0.0.1:3000/static/userhead/1.jpg" style="width: 25px"/>
                        <span>chenyuyuan</span>
                    </div>
                    <div class="shadow-smaller" style="background-color: white;margin-left: 10px;margin-right:-10px;padding:15px;border:1px #fafafa;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px; ">
                        <textarea id="anscontent" style="width: 100%;height: 100px;border: 0;" placeholder="请写回答"></textarea>
                    </div>
                    <div class="shadow-smaller" style="height:64px;background-color: white;margin-left: 10px;margin-right:-10px;padding:15px;border:1px #fafafa;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px; ">
                        <button id="submitanswer" class="btn btn-info" style="position: relative;float: right">提交答案</button>
                    </div>
                </div>

                {%for key in answered%}
                <div class="shadow-smaller" style="background-color: white;margin-left: 10px;margin-right:-10px;padding:15px;border:1px #fafafa;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px; ">
                   <span style="font-weight: bold;font-size: 20px">{{key.queTitle}}</span>
                    <br/>
                    <img src="http://127.0.0.1:3000/static/userhead/{{key.uid}}.jpg" style="width: 25px">
                    <span style="font-size: 18px;font-family: 'Helvetica Neue';">{{key.account}}</span>
                    <span class="text-muted">,{{key.shortIntro}}</span>
                    <p class="text-muted" style="font-size: 14px">{{key.like}}人赞同了该答案</p>
                    <p style="font-size: 15px;line-height: 24px">{{key.content}}</p>
                    <p class="text-muted" style="font-size: 14px">发布于{{key.time}}</p>
                    <div>
                        <span class="text-info" style="background-color:#e5f2ff;padding:6px 12px 6px 12px;border: #31708f 1px;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px;">▲132</span>
                        <span class="text-info" style="background-color:#e5f2ff;padding:6px 12px 6px 12px;border: #31708f 1px;border-top-right-radius:4px; border-top-left-radius:4px; border-bottom-left-radius:4px; border-bottom-right-radius:4px;">▼</span>
                        <span id="comment{{key.id}}" class="text-muted comment" name="{{key.id}}" style="margin-left: 20px;">{{key.comCount}}条评论</span>
                        <span class="text-muted" style="margin-left: 20px;">分享</span>
                        <span class="text-muted" style="margin-left: 20px;">收藏</span>
                        <span class="text-muted" style="margin-left: 20px;">•••</span>
                    </div>
                    <hr id="line{{key.id}}" style="display:none;margin-top: 15px;margin-bottom: 15px"/>
                    <div id="thetopcomment" style="" name="0">
                        <div class="input-group" style="margin-top: 10px;">
                            <input type="text" class="form-control">
                            <span class="input-group-addon"  onclick='var content= $(this).prev().val();var ansid=$(this).parent().parent().prev().prev().find(".comment").attr("name");datas={"ansid":ansid,"content":content,"pid":-1};$.ajax({url:"http://127.0.0.1:3000/comment/answer/submit",type:"POST",data:JSON.stringify(datas),contentType:"application/json; charset=UTF-8",dataType:"json",success:function (data) {if(data.data["msg"]=="good"){alert("评论成功")}window.location.reload() },error:function(a,b,c) {console.log(a.status+"::"+a.readyState+"::"+b) }})' style="background-color: #6db0ff;color:white;width: 50px">发表</span>
                        </div>
                    </div>
                </div>
                {%endfor%}
                <ul class="pagination" style="margin-left: 30px;margin-right: 30px">
                    <li>
                        <a href="#">Prev</a>
                    </li>
                    <li>
                        <a href="#">1</a>
                    </li>
                    <li>
                        <a href="#">2</a>
                    </li>
                    <li>
                        <a href="#">3</a>
                    </li>
                    <li>
                        <a href="#">4</a>
                    </li>
                    <li>
                        <a href="#">5</a>
                    </li>
                    <li>
                        <a href="#">Next</a>
                    </li>
                </ul>
            </div>
            <div class="col-md-3 column" style="position: fixed;right:16%">
                <ul>
                    <li>
                        Lorem ipsum dolor sit amet
                    </li>
                    <li>
                        Consectetur adipiscing elit
                    </li>
                    <li>
                        Integer molestie lorem at massa
                    </li>
                    <li>
                        Facilisis in pretium nisl aliquet
                    </li>
                    <li>
                        Nulla volutpat aliquam velit
                    </li>
                    <li>
                        Faucibus porta lacus fringilla vel
                    </li>
                    <li>
                        Aenean sit amet erat nunc
                    </li>
                    <li>
                        Eget porttitor lorem
                    </li>
                </ul>
            </div>
            <div class="col-md-2 column">
            </div>
        </div>
        <hr style="margin: 20px;">
        <div class="row clearfix">
            <div class="col-md-2 column">
            </div>
            <div class="col-md-5 column">
                <address> <strong>hit.</strong><br /> 795 Folsom Ave, Suite 600<br /> San Francisco, CA 94107<br /> <abbr title="Phone">P:</abbr> (123) 456-7890</address>
            </div>
            <div class="col-md-3 column">
            </div>
            <div class="col-md-2 column">
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" charset="UTF-8">
    function ParentTree() {this.nodes = [];}function ParentTreeNode(data, parent) {this.data = data || null;this.parent = parent || 0;}
    $(document).ready(function () {
        
        $('#share').click(function () {
            alert("111111");
            var v="ppp";
            window.clipboardData.setData("text",v);
        });
    $('#toanswer').click(function () {
        if($('#answering').css('display')=='none'){
            $('#answering').css('display','');
            // var a={{title|tojson}}
            // alert(a)
        }
    })

        $('#submitanswer').click(function () {
            var a={{questionid|tojson}}
            var data={
                'anscontent':$('#anscontent').val(),
                'qid':a
            }
            // alert($('#anscontent').val())
            $.ajax({
                type:'POST',
                url:'http://127.0.0.1:3000/submit/answering',
                contentType: 'application/json; charset=UTF-8',
                data:JSON.stringify(data),
                dataType:'json',
                success:function (data) {
                    if(data.msg==true)
                        location.reload();
                }
            })
        })
        $(".comment").on("click",function () {
            var kingdom=$(this).parent().next().next();
            var pt = new ParentTree();
            ansid=$(this).attr("name")//得到点击的回答id
            //alert(ansid)
            if(kingdom.attr("name")=="0"){
                kingdom.attr("name","1")
                //kingdom.css("display","")
                var data={
                    "ansid":ansid
                }
                $.ajax({
                url:'http://127.0.0.1:3000/comment/answer',
                type:'POST',
                contentType: 'application/json; charset=UTF-8',
                dataType:'json',
                data:JSON.stringify(data),
                success:function (data) {
                    if(data.msg=='1'){
                        
                        newdata=data.data;
                        //console.log(newdata)
                        for(var key in newdata){
                            for(var king in newdata){
                                if(newdata[key].pid==-1){
                                    pt.nodes.push(new ParentTreeNode(newdata[key], -1));
                                    break;
                                }
                                else if(newdata[king].id==newdata[key].pid){
                                    pt.nodes.push(new ParentTreeNode(newdata[key], king));
                                    break;
                                }
                            }
                        }
                        maxDepth=0;
                        data={
                            "ansid":ansid,
                            
                        }
                        console.log("data.ansid:"+data.ansid)
                        //alert(ansid)

                    //console.log(pt.nodes[1].data)
                    for(var i=0;i<pt.nodes.length;i++){
                        depth=0;
                        for (var j=i; j!=-1;j=pt.nodes[j].parent){
                            depth=depth+1;
                        }
                        if(depth>maxDepth)maxDepth=depth
                    }
                    commentinput="                        <div class=\"input-group\" style=\"margin-top: 10px;\">\n" +
                            "                            <input type=\"text\" class=\"form-control\">\n" +
                            "                            <span class=\"input-group-addon commentsubmit\" onclick='k=$(this); var a= $(this).prev().val();var b=$(this).parent().parent().attr(\"name\");datas={\"ansid\":ansid,\"content\":a,\"pid\":b};$.ajax({url:\"http://127.0.0.1:3000/comment/answer/submit\",type:\"POST\",data:JSON.stringify(datas),contentType:\"application/json; charset=UTF-8\",dataType:\"json\",success:function (data) {if(data.msg==\"good\"){alert(\"回复成功\")}window.location.reload() },error:function(a,b,c) {console.log(a.status+\"::\"+a.readyState+\"::\"+b) }})' style=\"background-color: #6db0ff;color:white;width: 50px\">回复</span>\n" +
                            "                        </div>"
                    for(var i in pt.nodes){
                        if(pt.nodes[i].parent==-1){
                            kingdom.append("<div class='parent' name=\""+i+"\" style=\"background-color: #fafafa;margin-top: 10px;border:1px solid #eeeeee;padding: 7px;border-top-right-radius:8px; border-top-left-radius:8px; border-bottom-left-radius:8px; border-bottom-right-radius:8px;\">\n" +
                "        <div name=\""+pt.nodes[i].data.id+"\">\n" +
                "            <img src=\"http://127.0.0.1:3000/static/userhead/"+pt.nodes[i].data.uid+".jpg\" style=\"width: 15px\">\n" +
                "            <span>"+pt.nodes[i].data.account+":</span>\n" +
                "            <span>"+pt.nodes[i].data.content+"</span>\n" +
                "            <img class='replyanscomment' name='0' src=\"http://127.0.0.1:3000/static/material/reply.jpg\" onclick='if($(this).attr(\"name\")==\"0\"){$(this).parent().append(commentinput);$(this).attr(\"name\",\"1\")}else{if($(this).next().next().next().css(\"display\")==\"none\"){$(this).next().next().next().css(\"display\",\"\")}else{$(this).next().next().next().css(\"display\",\"none\")}}' width=\"13px\" style='margin-left: 5px'>\n" +
                "            <img class='tipoffanscomment' src=\"http://127.0.0.1:3000/static/material/tipoff.png\" onclick='var  id=$(this).parent().attr(\"name\"); datas={\"anscomment\":id};$.ajax({url:\"http://127.0.0.1:3000/comment/answer/tipoff\",type:\"POST\",data:JSON.stringify(datas),contentType:\"application/json; charset=UTF-8\",dataType:\"json\",success:function(data) { if(data.msg==\"good\"){alert(\"已举报\")} },error:function(a,b,c) {console.log(a.status+\"::\"+a.readyState+\"::\"+b) }})' width=\"13px\" style='margin-left: 5px'>\n" +
                "            <span class=\"pull-right\">"+pt.nodes[i].data.time+"</span>" +
                "        </div>\n" +
                "    </div>")
                            pt.nodes[i].parent=-2
                        }
                    }
                    for (var i=0;i<maxDepth+3;i++){
                        for (var p=0;p<pt.nodes.length;p++){
                            kingdom.find("div[name='"+pt.nodes[p].parent+"'].parent").append("<div class='parent' name=\""+p+"\" style=\"background-color: #fafafa;margin-top: 10px;border:1px solid #eeeeee;padding: 7px;border-top-right-radius:8px; border-top-left-radius:8px; border-bottom-left-radius:8px; border-bottom-right-radius:8px;\">\n" +
                "        <div name=\""+pt.nodes[p].data.id+"\">\n" +
                "            <img src=\"http://127.0.0.1:3000/static/userhead/"+pt.nodes[p].data.uid+".jpg\" style=\"width: 15px\" style='margin-left: 5px'>\n" +
                "            <span>"+pt.nodes[p].data.account+":</span>\n" +
                "            <span>"+pt.nodes[p].data.content+"</span>\n" +
                "            <img class='replyanscomment' name='0' src=\"http://127.0.0.1:3000/static/material/reply.jpg\" onclick='if($(this).attr(\"name\")==\"0\"){$(this).parent().append(commentinput);$(this).attr(\"name\",\"1\")}else{if($(this).next().next().next().css(\"display\")==\"none\"){$(this).next().next().next().css(\"display\",\"\")}else{$(this).next().next().next().css(\"display\",\"none\")}}' style='margin-left: 5px'>\n" +
                "            <img class='tipoffanscomment' src=\"http://127.0.0.1:3000/static/material/tipoff.png\" onclick='var  id=$(this).parent().attr(\"name\"); datas={\"anscomment\":id};$.ajax({url:\"http://127.0.0.1:3000/comment/answer/tipoff\",type:\"POST\",data:JSON.stringify(datas),contentType:\"application/json; charset=UTF-8\",dataType:\"json\",success:function(data) { if(data.msg==\"good\"){alert(\"已举报\")} },error:function(a,b,c) {console.log(a.status+\"::\"+a.readyState+\"::\"+b) }})' width=\"13px\" style='margin-left: 5px'>\n" +
                "            <span class=\"pull-right\">"+pt.nodes[p].data.time+"</span>" +
                "        </div>\n" +
                "    </div>")
                            pt.nodes[p].parent=-2
                        }
                    }
                    }
                    else{
                        console.log("This answer have no comments")
                    }

                },
                error:function (e) {alert(e.status)}
            })
            }
            else if(kingdom.css("display")=="none"&&kingdom.attr("name")=="1"){
                //kingdom.css("display","");
            }
            else{
                //kingdom.css("display","none");
            }
        })
        // $('#share').click(function () {
        //     alert("111111")
        //     var v="ppp"
        //     // window.clipboardData.setData("text",v);
        // })
        $(".commentsubmit").on("click",function () {
            alert("ha")
        })
        $('.replyanscomment').on("click",function () {
            $(this).append("<div class=\"input-group\" style=\"margin-top: 10px;\">\n" +
                "                            <input type=\"text\" class=\"form-control\">\n" +
                "                            <span class=\"input-group-addon\" style=\"background-color: #6db0ff;color:white;width: 50px\">发表</span>\n" +
                "                        </div>")
        })
    })
    </script>
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
</body>
</html>

